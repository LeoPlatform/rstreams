---
title: "Project Organization"
date: 2018-12-29T11:02:05+06:00
weight: 2
draft: false
---

{{< collapse-light "ToC" >}}
{{< toc  >}}
{{</ collapse-light >}}

# Summary
This doc explains how projects are organized and what all the files are and what they mean, using the example project from
the [Getting Started Guide](../getting-started).

# Root-level Files and Directories

| Path | Description |
|---------|--------|
| .mock-data/ | Developers put their mock data in this directory.  The SDK, when it generates mock data, will also put it in here   |
| .vscode/     | Config to make working in Visual Studio code easier with RStreams  |
| bots/ | All bots are in this directory  |
| cloudformation/ | Additional CloudFormation templates that will be merged into the final stack go in this directory  |
| lib/ | Standard directory developers will often use to put project-specific files within  |
| node_modules/ | Standard Node JS location for downloaded 3rd party Node libraries  |
| test/ | A directory for the projects unit tests  |
| .env.dev | A [dotenv](https://www.npmjs.com/package/dotenv) property file for local config |
| .gitignore | Ignore certain files |
| .nycrc.json | Generates unit test code coverage using the popular [Instanbul NYC](https://www.npmjs.com/package/nyc) library |
| package.json | The ubiquitous Node file containing NPM run scripts and your project's dependencies |
| project-config-new.def.json | RStreams Flow will soon release a new way of handling your project's configuration, this is a preview of that feature  |
| project-config-new.ts | RStreams Flow will soon release a new way of handling your project's configuration, this is a preview of that feature  |
| serverless.yml | Config used by the [Serverless Framework](https://www.serverless.com/) to build and run with an RStreams-specific plugin |
| tsconfig.json | Standard [tsconfig file](https://www.typescriptlang.org/docs/handbook/tsconfig-json.html) for typescript support |
| types.d.ts | Top-level types used by soon to be released RStreams Flow project config feature |
| webpack.config.js | Standard [webpack file](https://webpack.js.org/) to help in bundling builds |


# Project Serverless File
Each project has a root-level `serverless.yml` file.  Here's an abbreviated version of the one from the RStreams Flow Example project 
highlighting a few points of interest.

{{< collapse-light "Example Project Serverless File" true >}}
```yaml {linenos=inline,anchorlinenos=true,lineanchors=projserverless}
service: rstreams-example

frameworkVersion: '3'
useDotenv: true

plugins:
  - serverless-leo
  - serverless-webpack

package:
  individually: true

custom:
  leo:
    rsfVersion: 3,
    rsfTemplateTokens:
      project-name: "rstreams-example"
      rstreams-bus: "ClintTestBus-Bus"
      region: "us-west-2"

    botIdExcludeStage: true
    configurationPath: project-config-new.def.json

    rsfConfigResolutionType: secretsmanager
    replicationRegions: 
      - us-east-1 => us-west-2
      - us-west-2 => us-east-1 
      - europe-west-2

  convention:
    functions:
      folders:
        - api
        - bots
      pattern:
        - '*.yml'
        - '*.yaml'
    resources:
      folders:
        - cloudformation
      pattern:
        - '*.yml'
        - '*.yaml'
        - '*.js'
        - '*.json'
        - '*.ts'
  included: ${file(./node_modules/serverless-convention/index.js)}
  
  leoStack: ${RStreamsBus}
  dev:
    stackParameters:
      - ParameterKey: RStreamsBus
        ParameterValue: ClintTestBus-Bus
      - ParameterKey: MyStage2
        ParameterValue: Prod
  test:
    # stackParameters:
  staging:
    # stackParameters:
  prod:
    # stackParameters:

provider:
  name: aws
  runtime: nodejs14.x
  versionFunctions: false
  stage: ${opt:stage, 'dev'}
  
  stackParameters: ${self:custom.${self:provider.stage}.stackParameters}

functions:
  - ${self:custom.included.functions} # Auto-include functions using serverless-convention

resources:
  - ${self:custom.included.resources} # Auto-include resources using serverless-convention


```
{{</ collapse-light >}}

* [Line 1](#projserverless-1) : this is the name of your microservice, it is referenced in various places including bot-specific yml files
* [Line 3](#projserverless-3) : tells serverless to use the popular [dotenv project](https://www.serverless.com/framework/docs/environment-variables)

**Bot**
A bot is logical wrapper around code that executes to interact with an RStreams queue.  Bots are found in the `{project_dir}/bots/{bot_dir}`.  Each
bot has its own `serverless.yml` file.  Here's an example from the `weather-loader` bot of the RStreams Flow Example project.

{{< collapse-light "Example 1 code" true >}}
```yaml {linenos=inline,anchorlinenos=true,lineanchors=weatherloaderserverless}
weather-loader:
  name: ${self:service}-weather-loader
  handler: bots/weather-loader/index.handler
  description: Bot generated by serverless-leo
  memorySize: 256
  timeout: 300
  role: BotRole
  events:
    - leo:
        destination: rstreams-example.weather
        cron: 0 */1 * * * * 
        extra_data: 123
```
{{</ collapse-light >}}

**Stage**
Each RStreams Flow bot executes in the context of an environment, called a `stage`, such as dev/test/staging/prod.
The RStreams Flow example template project expects that your stage, the environment, is `dev` and that a file named `.env.dev` exists
that contains the name of the AWS secrets manager secret that contains the RStreams bus instance config to connect to.



```json
serverless invoke-bot --stage {environment} --function {bot-name}
```

RSTREAMS_CONFIG_SECRET="rstreams-us-west-2-clint-bus"

# Invoke a bot locally hitting an actual RStreams queue
{{< notice info >}}The invoke-bot startup performance was significantly improved in May 2022.{{</ notice >}}

```json
serverless invoke-bot --stage {environment} --function {bot-name}
```

* `serverless invoke-bot` : an RStreams plugin to serverless
* `--stage {environment}` : specifies the environment to run the bot within which will change the configuration used
* `--function {bot-name}` : the bot to invoke






serverless invoke-bot --stage dev --function weather-loader