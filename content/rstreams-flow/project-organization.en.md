---
title: "Running Locally"
date: 2018-12-29T11:02:05+06:00
weight: 2
draft: false
---

{{< collapse-light "ToC" >}}
{{< toc  >}}
{{</ collapse-light >}}

# Summary
This doc explains how projects are organized and what all the files are and what they mean, using the example project from
the [Getting Started Guide](../getting-started).

# Root-level Files and Directories

| Animal  | Sounds |
|---------|--------|
| this     | doc   |
| Dog     | Woof   |
| Cricket | Chirp  |

# Project Serverless File
Each project has a root-level `serverless.yml` file.  Here's an abbreviated version of the one from the RStreams Flow Example project 
highlighting a few points of interest.

{{< collapse-light "Example Project Serverless File" true >}}
```yaml {linenos=inline,anchorlinenos=true,lineanchors=projserverless}
service: rstreams-example

frameworkVersion: '3'
useDotenv: true

plugins:
  - serverless-leo
  - serverless-webpack

package:
  individually: true
#  artifact: ${opt:artifact, ""}

custom:
  leo:
    botIdExcludeStage: true
    configurationPath: project-config-new.def.json

    rsfConfigResolutionType: secretsmanager
    _rsfConfigResolutionType: secretsmanager|env
    replicationRegions: 
      - us-east-1 => us-west-2
      - us-west-2 => us-east-1 
      - europe-west-2

  convention:
    functions:
      folders:
        - api
        - bots
      pattern:
        - '*.yml'
        - '*.yaml'
    resources:
      folders:
        - cloudformation
      pattern:
        - '*.yml'
        - '*.yaml'
        - '*.js'
        - '*.json'
        - '*.ts'
  included: ${file(./node_modules/serverless-convention/index.js)}
  
  leoStack: ${RStreamsBus}
  dev:
    stackParameters:
      - ParameterKey: RStreamsBus
        ParameterValue: ClintTestBus-Bus
      - ParameterKey: MyStage2
        ParameterValue: Prod
  test:
    # stackParameters:
  staging:
    # stackParameters:
  prod:
    # stackParameters:
  us-east-1:
    deploymentBucket: leo-cli-publishbucket-19e80lsbylz0f
  us-west-2:
    deploymentBucket: leo-cli-publishbucket-13ickrmrh6vyd
  no-region:
    deploymentBucket: leo-cli-publishbucket-13ickrmrh6vyd

provider:
  name: aws
  runtime: nodejs14.x
  versionFunctions: false
  deploymentBucket: ${self:custom.${opt:region, 'no-region'}.deploymentBucket}
  stage: ${opt:stage, 'dev'}
  
  stackParameters: ${self:custom.${self:provider.stage}.stackParameters}

functions:
  - ${self:custom.included.functions} # Auto-include functions using serverless-convention

resources:
  - ${self:custom.included.resources} # Auto-include resources using serverless-convention
```
{{</ collapse-light >}}

* [Line 1](#projserverless-1) : this is the name of your microservice, it is referenced in various places including bot-specific yml files
* [Line 3](#projserverless-3) : tells serverless to use the popular [dotenv project](https://www.serverless.com/framework/docs/environment-variables)

**Bot**
A bot is logical wrapper around code that executes to interact with an RStreams queue.  Bots are found in the `{project_dir}/bots/{bot_dir}`.  Each
bot has its own `serverless.yml` file.  Here's an example from the `weather-loader` bot of the RStreams Flow Example project.

{{< collapse-light "Example 1 code" true >}}
```yaml {linenos=inline,anchorlinenos=true,lineanchors=weatherloaderserverless}
weather-loader:
  name: ${self:service}-weather-loader
  handler: bots/weather-loader/index.handler
  description: Bot generated by serverless-leo
  memorySize: 256
  timeout: 300
  role: BotRole
  events:
    - leo:
        destination: rstreams-example.weather
        cron: 0 */1 * * * * 
        extra_data: 123
```
{{</ collapse-light >}}

**Stage**
Each RStreams Flow bot executes in the context of an environment, called a `stage`, such as dev/test/staging/prod.
The RStreams Flow example template project expects that your stage, the environment, is `dev` and that a file named `.env.dev` exists
that contains the name of the AWS secrets manager secret that contains the RStreams bus instance config to connect to.



```json
serverless invoke-bot --stage {environment} --function {bot-name}
```

RSTREAMS_CONFIG_SECRET="rstreams-us-west-2-clint-bus"

# Invoke a bot locally hitting an actual RStreams queue
{{< notice info >}}The invoke-bot startup performance was significantly improved in May 2022.{{</ notice >}}

```json
serverless invoke-bot --stage {environment} --function {bot-name}
```

* `serverless invoke-bot` : an RStreams plugin to serverless
* `--stage {environment}` : specifies the environment to run the bot within which will change the configuration used
* `--function {bot-name}` : the bot to invoke






serverless invoke-bot --stage dev --function weather-loader